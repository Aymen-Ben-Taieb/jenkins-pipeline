"use strict";(self.webpackChunkremote_dev_env=self.webpackChunkremote_dev_env||[]).push([[8570],{5627:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>k,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var n=a(7462),i=(a(7294),a(3905)),r=a(2004);const o={sidebar_position:3},l="How to Integrate Keycloak with AWX",s={unversionedId:"Single Sign-On with Keycloak/Integration with AWX",id:"Single Sign-On with Keycloak/Integration with AWX",title:"How to Integrate Keycloak with AWX",description:"1. Navigate to setttings on AWX -> Miscellaneous System settings",source:"@site/docs/Single Sign-On with Keycloak/Integration with AWX.md",sourceDirName:"Single Sign-On with Keycloak",slug:"/Single Sign-On with Keycloak/Integration with AWX",permalink:"/docs/Single Sign-On with Keycloak/Integration with AWX",draft:!1,editUrl:"https://github.com/Chamssiddine/remote-development-environment/docs/Single Sign-On with Keycloak/Integration with AWX.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Installation & Configuration of Keycloak",permalink:"/docs/Single Sign-On with Keycloak/Installation & Configuration of Keycloak"},next:{title:"Integration with Grafana",permalink:"/docs/Single Sign-On with Keycloak/Integration with Grafana"}},c={},d=[{value:"1. Navigate to setttings on AWX -&gt; Miscellaneous System settings",id:"1-navigate-to-setttings-on-awx---miscellaneous-system-settings",level:3},{value:"2. Edit Base URL of the service to your base URL or IP",id:"2-edit-base-url-of-the-service-to-your-base-url-or-ip",level:3},{value:"3. Go back to Settings, then SAML settings and replace the fields as shown below:",id:"3-go-back-to-settings-then-saml-settings-and-replace-the-fields-as-shown-below",level:3},{value:"<code>SAML Service Provider Entity ID</code>",id:"saml-service-provider-entity-id",level:3},{value:"<code>SAML Service Provider Public Certificate</code>",id:"saml-service-provider-public-certificate",level:3},{value:"<code>SAML Service Provider Private Key</code>",id:"saml-service-provider-private-key",level:3},{value:"Generate a certificate and Public key by typing in :",id:"generate-a-certificate-and-public-key-by-typing-in-",level:3},{value:"Verify your Configuration by typing this command and upload it to keycloak when creating your client:",id:"verify-your-configuration-by-typing-this-command-and-upload-it-to-keycloak-when-creating-your-client",level:3},{value:"Keycloak Side",id:"keycloak-side",level:2}],p={toc:d},m="wrapper";function k(e){let{components:t,...a}=e;return(0,i.kt)(m,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-integrate-keycloak-with-awx"},"How to Integrate Keycloak with AWX"),(0,i.kt)("h3",{id:"1-navigate-to-setttings-on-awx---miscellaneous-system-settings"},"1. Navigate to setttings on AWX -> Miscellaneous System settings"),(0,i.kt)("h3",{id:"2-edit-base-url-of-the-service-to-your-base-url-or-ip"},"2. Edit Base URL of the service to your base URL or IP"),(0,i.kt)("h3",{id:"3-go-back-to-settings-then-saml-settings-and-replace-the-fields-as-shown-below"},"3. Go back to Settings, then SAML settings and replace the fields as shown below:"),(0,i.kt)("h3",{id:"saml-service-provider-entity-id"},(0,i.kt)("inlineCode",{parentName:"h3"},"SAML Service Provider Entity ID")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ruby"},"https://keycloakdomainname\n")),(0,i.kt)("h3",{id:"saml-service-provider-public-certificate"},(0,i.kt)("inlineCode",{parentName:"h3"},"SAML Service Provider Public Certificate")),(0,i.kt)("h3",{id:"saml-service-provider-private-key"},(0,i.kt)("inlineCode",{parentName:"h3"},"SAML Service Provider Private Key")),(0,i.kt)("h3",{id:"generate-a-certificate-and-public-key-by-typing-in-"},"Generate a certificate and Public key by typing in :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"openssl req -new -x509 -days 3650 -nodes -out saml.crt -keyout saml.key\n")),(0,i.kt)("p",null," ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"SAML Service Provider Organization Info:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "en-US": {\n    "url": "http://keycloakserviceip",\n    "name": "keycloak",\n    "displayname": "keycloak"\n  }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"}," Specify SAML Service Provider Technical Contact:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "emailAddress": "chamseddine.abderrahim@gmail.com",\n  "givenName": "chamseddine"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"}," ",(0,i.kt)("inlineCode",{parentName:"strong"},"Specify Service Provider Support Contact:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "emailAddress": "chamseddine.abderrahim@gmail.com",\n  "givenName": "chamseddine"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"}," ",(0,i.kt)("inlineCode",{parentName:"strong"},"Specify SAML Enabled Identity Provider:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "keycloak": {\n    "x509cert": "certificatewithoutbreakinglines",\n    "attr_first_name": "first_name",\n    "attr_email": "email",\n    "url": "http://keycloakserviceip/auth/realms/tower/protocol/saml",\n    "attr_user_permanent_id": "name_id",\n    "entity_id": "http://keycloakserviceip/auth/realms/tower",\n    "attr_groups": "groups",\n    "attr_last_name": "last_name",\n    "attr_username": "username"\n  }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"}," ",(0,i.kt)("inlineCode",{parentName:"strong"},"Specify SAML Organization Map:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'{\n  "Default": {\n    "users": true\n  },\n  "Systems Engineering": {\n    "remove_users": false,\n    "remove_admins": false,\n    "users": true,\n    "admins": [\n      "chamseddine.abderrahim@gmail.com"\n    ]\n  }\n}\n')),(0,i.kt)("div",{className:"video__wrapper"},(0,i.kt)(r.Z,{className:"video__player",controls:!0,height:"100%",url:"/awxsettingstochange.mov",width:"100%",mdxType:"ReactPlayer"})),(0,i.kt)("h3",{id:"verify-your-configuration-by-typing-this-command-and-upload-it-to-keycloak-when-creating-your-client"},"Verify your Configuration by typing this command and upload it to keycloak when creating your client:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl -k -L http://AwxServiceIP/sso/metadata/saml/ > awx-keycloak.xml\n")),(0,i.kt)("h2",{id:"keycloak-side"},"Keycloak Side"),(0,i.kt)("p",null," ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Create Your REALM named: tower"))),(0,i.kt)("p",null," ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},'Import the "awx-keycloak.xml" to your REALM'))),(0,i.kt)("div",{className:"video__wrapper"},(0,i.kt)(r.Z,{className:"video__player",controls:!0,height:"100%",url:"/createrealminkeycloak.mov",width:"100%",mdxType:"ReactPlayer"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"}," ",(0,i.kt)("inlineCode",{parentName:"strong"},"Add Your certificate and Private key to your REALME "))),(0,i.kt)("div",{className:"video__wrapper"},(0,i.kt)(r.Z,{className:"video__player",controls:!0,height:"100%",url:"/keycloakawxone.m4v",width:"100%",mdxType:"ReactPlayer"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Add Mappers for the saml request nagivate to infrastructure/modules/awxsaml and type in:"))),(0,i.kt)("admonition",{title:"Important",type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"Change the variable values inside variables.tf file to match your service URL etc....")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"terraform init\nterraform apply\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"Verify the SSO is working"))),(0,i.kt)("div",{className:"video__wrapper"},(0,i.kt)(r.Z,{className:"video__player",controls:!0,height:"100%",url:"/verifyeverythingandtestsso.m4v",width:"100%",mdxType:"ReactPlayer"})))}k.isMDXComponent=!0}}]);