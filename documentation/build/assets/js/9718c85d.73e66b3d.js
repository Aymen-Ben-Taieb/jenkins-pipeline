"use strict";(self.webpackChunkremote_dev_env=self.webpackChunkremote_dev_env||[]).push([[9619],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>v});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=l(n),h=a,v=d["".concat(c,".").concat(h)]||d[h]||u[h]||o;return n?r.createElement(v,s(s({ref:t},p),{},{components:n})):r.createElement(v,s({ref:t},p))}));function v(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=h;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[d]="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},435:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const o={sidebar_position:5},s=void 0,i={unversionedId:"Configuration Management/Serverspec",id:"Configuration Management/Serverspec",title:"Serverspec",description:"Why Use ServerSpec with Ansible",source:"@site/docs/Configuration Management/Serverspec.md",sourceDirName:"Configuration Management",slug:"/Configuration Management/Serverspec",permalink:"/docs/Configuration Management/Serverspec",draft:!1,editUrl:"https://github.com/Chamssiddine/remote-development-environment/docs/Configuration Management/Serverspec.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Configuring AWX",permalink:"/docs/Configuration Management/Configuring AWX"},next:{title:"Single Sign-On with Keycloak",permalink:"/docs/category/single-sign-on-with-keycloak"}},c={},l=[{value:"Why Use ServerSpec with Ansible",id:"why-use-serverspec-with-ansible",level:3},{value:"Docker ServerSpec File: <code>docker_spec.rb</code>",id:"docker-serverspec-file-docker_specrb",level:3},{value:"Dev Tools ServerSpec File: <code>dev_tools.rb</code>",id:"dev-tools-serverspec-file-dev_toolsrb",level:3},{value:"Bash Script: <code>serverspec.bash</code>",id:"bash-script-serverspecbash",level:3},{value:"Run the serverspec tests",id:"run-the-serverspec-tests",level:3}],p={toc:l},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h3",{id:"why-use-serverspec-with-ansible"},"Why Use ServerSpec with Ansible"),(0,a.kt)("p",null,"While Ansible is a powerful infrastructure automation tool that can provision, configure, and orchestrate servers, it does not provide built-in testing capabilities. ServerSpec, on the other hand, is a testing framework specifically designed to verify the state and configuration of servers."),(0,a.kt)("p",null,"Here are a few reasons why using ServerSpec with Ansible can be beneficial:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Validation of Desired State"),": Ansible ensures that servers are provisioned and configured according to the desired state defined in your Ansible playbooks. However, it's essential to validate that the applied configurations are accurate and meet the expected outcomes. ServerSpec enables you to write tests in a human-readable format to verify the state of the provisioned servers, ensuring that they adhere to the desired configuration.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Continuous Integration and Deployment"),": ServerSpec tests can be integrated into your continuous integration and deployment pipelines. By including ServerSpec tests alongside your Ansible playbooks, you can perform automated testing to validate the correctness of your infrastructure and catch any configuration issues or unexpected changes before deploying to production.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Documentation and Compliance"),": ServerSpec tests serve as documentation for your infrastructure. They provide clear and concise statements about the expected configuration and behavior of your servers. Additionally, ServerSpec can help you meet compliance requirements by ensuring that your servers adhere to specific security or regulatory standards."))),(0,a.kt)("p",null,"By combining the automation capabilities of Ansible with the testing capabilities of ServerSpec, you can have more confidence in the correctness and stability of your infrastructure."),(0,a.kt)("h3",{id:"docker-serverspec-file-docker_specrb"},"Docker ServerSpec File: ",(0,a.kt)("inlineCode",{parentName:"h3"},"docker_spec.rb")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'serverspec'\nset :backend, :exec\n\ndescribe package('docker-ce') do\n  it { should be_installed }\nend\n\ndescribe package('docker-ce-cli') do\n  it { should be_installed }\nend\n\ndescribe package('containerd.io') do\n  it { should be_installed }\nend\n\ndescribe service('docker') do\n  it { should be_enabled }\n  it { should be_running }\nend\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"docker_spec.rb")," file is a ServerSpec test file that verifies the state of Docker on a server. It contains a series of tests using the ServerSpec syntax to check if Docker packages are installed and if the Docker service is enabled and running."),(0,a.kt)("p",null,"The tests in the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker_spec.rb")," file perform the following verifications:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Check if the ",(0,a.kt)("inlineCode",{parentName:"li"},"docker-ce")," package is installed."),(0,a.kt)("li",{parentName:"ul"},"Check if the ",(0,a.kt)("inlineCode",{parentName:"li"},"docker-ce-cli")," package is installed."),(0,a.kt)("li",{parentName:"ul"},"Check if the ",(0,a.kt)("inlineCode",{parentName:"li"},"containerd.io")," package is installed."),(0,a.kt)("li",{parentName:"ul"},"Check if the ",(0,a.kt)("inlineCode",{parentName:"li"},"Docker service")," is enabled and running.")),(0,a.kt)("p",null,"By running these ServerSpec tests, you can ensure that Docker is correctly installed and functioning on the target servers."),(0,a.kt)("h3",{id:"dev-tools-serverspec-file-dev_toolsrb"},"Dev Tools ServerSpec File: ",(0,a.kt)("inlineCode",{parentName:"h3"},"dev_tools.rb")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"require 'serverspec'\n\n# Define the packages to be installed\npackages = %w[curl wget rsync golang-go ansible vagrant ruby git]\nset :backend, :exec\n\n# Check if the packages are installed\npackages.each do |package|\n  describe package(package) do\n    it { should be_installed }\n  end\nend\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"dev_tools.rb")," file is a ServerSpec test file that verifies if the dev tools are installed on the dev workstations or not. It contains a series of tests using the ServerSpec syntax to check if the packages installed by AWX(ansible) are installed."),(0,a.kt)("p",null,"The tests in the ",(0,a.kt)("inlineCode",{parentName:"p"},"docker_spec.rb")," file perform the following verifications:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Check if ",(0,a.kt)("inlineCode",{parentName:"li"},"curl wget rsync golang-go ansible vagrant ruby git")," package are installed.")),(0,a.kt)("h3",{id:"bash-script-serverspecbash"},"Bash Script: ",(0,a.kt)("inlineCode",{parentName:"h3"},"serverspec.bash")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n# Generate the list of instances with zone europe-west9-a\ninstances=$(gcloud compute instances list --filter="zone:(europe-west9-a)" --format="value(name)")\n\n# Path to the docker_spec.rb file\nspec_file="docker_spec.rb"\ndev_tools="dev_tools.rb"\n# Copy docker_spec.rb to each instance and run the tests\nfor instance in $instances; do\n  echo "Copying docker_spec.rb and dev_tools to $instance..."\n  gcloud compute scp $spec_file $instance:~/ --zone=europe-west9-a\n  gcloud compute scp $dev_tools $instance:~/ --zone=europe-west9-a\n\n  echo "Installing Serverspec on $instance..."\n  # SSH into the instance and install Serverspec\n  gcloud compute ssh $instance --zone=europe-west9-a --command="sudo gem install serverspec >/dev/null && sudo gem install serverspec | tail -n 2"\n\n  echo "Running tests on $instance..."\n  # SSH into the instance and run the tests, suppressing the warning message\n  gcloud compute ssh $instance --zone=europe-west9-a --command="sudo rspec ~/docker_spec.rb --format documentation"\n  gcloud compute ssh $instance --zone=europe-west9-a --command="sudo rspec ~/dev_tools.rb   --format documentation"\n\n  echo "Cleaning up docker_spec.rb and dev_tools on $instance..."\n  # Remove the copied docker_spec.rb file from the instance\n  gcloud compute ssh $instance --zone=europe-west9-a --command="rm ~/docker_spec.rb ~/dev_tools.rb"\ndone\n\n')),(0,a.kt)("h3",{id:"run-the-serverspec-tests"},"Run the serverspec tests"),(0,a.kt)("p",null,"Navigate to the serverspec folder by typing the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cd provision/serverspec/spec\n")),(0,a.kt)("p",null,"the script will copy the serverspec files to each of the instance in ",(0,a.kt)("inlineCode",{parentName:"p"},"europe-west9-a")," zone, install serverspec with gem and run the serverspec files"),(0,a.kt)("p",null,"To run the ",(0,a.kt)("inlineCode",{parentName:"p"},"run_docker_serverspec.bash")," script, run the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bash serverspec.bash\n")),(0,a.kt)("p",null,"The script will execute the ServerSpec tests on each instance and display the output, including the status of the tests and any error messages."))}u.isMDXComponent=!0}}]);